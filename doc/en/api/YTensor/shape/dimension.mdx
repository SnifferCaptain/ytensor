# Shape Operations: Dimension Transformations

This document describes the dimension transformation methods for the `YTensor<T, dim>` class, including `unsqueeze()`, `squeeze()`, `repeat()`, and `unfold()`.

## Overview

| Method | Function | Dimension Change | Notes |
| --- | --- | --- | --- |
| `unsqueeze()` / `unsqueeze_()` | Inserts a dimension of size 1 | +1 | Zero-copy |
| `squeeze()` / `squeeze_()` | Removes dimension(s) of size 1 | -1 or -N | Zero-copy |
| `repeat()` / `repeat_()` | Repeats along dimensions | Unchanged | Requires copy |
| `unfold()` / `unfold_()` | Sliding window expansion | +1 | Zero-copy view |

---

## unsqueeze()

### Function Signature

```cpp
YTensor<T, dim+1> unsqueeze(int atDim) const;
YTensor<T, dim+1>& unsqueeze_(int atDim);
```

### Parameters

| Name | Type | Description |
| --- | --- | --- |
| `atDim` | `int` | Position to insert the dimension (supports negative indexing). |

### Core Function Description

Inserts a new dimension of size 1 at the specified position. Does not modify data, only shape information (view operation).

### Usage Example

```cpp
#include "ytensor_single.hpp"

void example() {
    yt::YTensor<float, 2> mat(3, 4);  // [3, 4]
    
    // Insert before dimension 0
    auto u0 = mat.unsqueeze(0);  // [1, 3, 4]
    std::cout << "Shape: [" << u0.shape()[0] << ", " << u0.shape()[1] << ", " << u0.shape()[2] << "]" << std::endl;
    
    // Insert at the end
    auto u_last = mat.unsqueeze(-1);  // [3, 4, 1]
    std::cout << "Shape: [" << u_last.shape()[0] << ", " << u_last.shape()[1] << ", " << u_last.shape()[2] << "]" << std::endl;
}
```

---

## squeeze()

### Function Signature

```cpp
// Remove a specific dimension (must have size 1)
YTensorBase squeeze(int atDim) const;
YTensorBase& squeeze_(int atDim);

YTensorBase squeeze() const;
YTensorBase& squeeze_();
```

### Core Function Description

Removes dimensions of size 1.
*   Specify `atDim`: Removes a specific dimension (throws exception or invalid if size is not 1).
*   No parameter: Removes all dimensions with size 1.
Does not modify data, only shape information (view operation).

### Usage Example

```cpp
yt::YTensor<float, 3> tensor(1, 3, 1);  // [1, 3, 1]

// Remove dimension 0
auto s0 = tensor.squeeze(0);  // [3, 1]
std::cout << "Shape: [" << s0.shape()[0] << ", " << s0.shape()[1] << "]" << std::endl;

// Remove all dimensions of size 1
auto s_all = tensor.squeeze();  // [3]
std::cout << "Shape: [" << s_all.shape()[0] << "]" << std::endl;
```

---

## repeat()

### Function Signature

```cpp
YTensorBase repeat(const std::vector<int>& repeats) const;
YTensorBase& repeat_(const std::vector<int>& repeats);
```

### Parameters

| Name | Type | Description |
| --- | --- | --- |
| `repeats` | `std::vector<int>` | Number of repetitions for each dimension. |

### Core Function Description

Repeats tensor content along dimensions. This operation **allocates new memory** and copies data.

### Usage Example

```cpp
yt::YTensor<float, 2> mat(2, 3);  // [2, 3]
mat.fill(1.0f);

// Repeat 2 times for dimension 0, 3 times for dimension 1
auto r = mat.repeat({2, 3});  // [4, 9]
std::cout << "Shape: [" << r.shape()[0] << ", " << r.shape()[1] << "]" << std::endl;
```

---

## unfold()

### Function Signature

```cpp
YTensorBase unfold(int atDim, int size, int step) const;
YTensorBase& unfold_(int atDim, int size, int step);
```

### Parameters

| Name | Type | Description |
| --- | --- | --- |
| `atDim` | `int` | The dimension to expand. |
| `size` | `int` | Window size. |
| `step` | `int` | Stride/step size. |

### Core Function Description

Returns a sliding window view. Expands a new extra dimension with `size` as window size and `step` as stride at the specified dimension.
Commonly used for convolution or image patching.

### Usage Example

```cpp
yt::YTensor<float, 1> vec(10);  // [10]

// Sliding window: size=3, step=2
auto u = vec.unfold(0, 3, 2);  // [4, 3]
// 4 = (10 - 3) / 2 + 1 windows
std::cout << "Shape: [" << u.shape()[0] << ", " << u.shape()[1] << "]" << std::endl;
```

---

## Full Example

```cpp
#include <iostream>
#include "ytensor_single.hpp"

int main() {
    yt::YTensor<float, 2> mat(3, 4);
    
    std::cout << "=== unsqueeze ===" << std::endl;
    auto u = mat.unsqueeze(0);
    std::cout << "Shape: [" << u.shape()[0] << ", " << u.shape()[1] << ", " << u.shape()[2] << "]" << std::endl;
    
    std::cout << "\n=== squeeze ===" << std::endl;
    auto s = u.squeeze(0);
    std::cout << "Shape: [" << s.shape()[0] << ", " << s.shape()[1] << "]" << std::endl;
    
    return 0;
}
```

---

## Related Content

- [Shape Querying](./query.mdx) - Using `shape()` and `ndim()` methods.
- [Shape Operations: Reshaping](./reshape.mdx) - Using the `reshape()` method.
